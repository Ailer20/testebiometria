<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Presença por Biometria</title>
</head>
<body>

    <h1>Registro de Presença</h1>
    <button id="biometriaBtn">Registrar Presença com Biometria</button>
    <div id="presencaLog"></div>

    <script>
        // Função para verificar suporte biométrico usando a WebAuthn API
        async function verificarSuporteBiometria() {
            // Verifica se o navegador suporta a WebAuthn API
            if ('credentials' in navigator && 'get' in navigator.credentials) {
                return true;
            }
            return false;
        }

        // Função para autenticar usando biometria
        async function autenticarBiometria() {
            try {
                // Opções para solicitar autenticação
                const publicKeyCredentialRequestOptions = {
                    challenge: new Uint8Array(32), // Um desafio aleatório gerado pelo servidor
                    timeout: 60000,
                    allowCredentials: [{
                        id: new Uint8Array(16),
                        type: "public-key",
                        transports: ["internal"] // "internal" para uso de biometria no dispositivo
                    }],
                    userVerification: "required" // Garantir autenticação biométrica
                };

                // Solicitar autenticação usando impressão digital
                const assertion = await navigator.credentials.get({
                    publicKey: publicKeyCredentialRequestOptions
                });

                if (assertion) {
                    const horario = new Date().toLocaleString('pt-BR');
                    const presencaLog = document.getElementById('presencaLog');
                    presencaLog.innerHTML += `<p>Presença registrada às ${horario}</p>`;
                    alert('Presença registrada com sucesso!');
                }
            } catch (error) {
                console.error('Falha na autenticação biométrica:', error);
                alert('Autenticação falhou ou foi cancelada.');
            }
        }

        // Função chamada ao clicar no botão
        async function registrarPresenca() {
            const suporteBiometria = await verificarSuporteBiometria();

            if (suporteBiometria) {
                console.log('Dispositivo com suporte biométrico detectado');
                await autenticarBiometria();
            } else {
                alert('Este dispositivo não suporta autenticação biométrica.');
            }
        }

        // Adiciona o evento ao botão
        document.addEventListener('DOMContentLoaded', function() {
            const botao = document.getElementById('biometriaBtn');
            botao.addEventListener('click', registrarPresenca);
        });
    </script>

</body>
</html>
